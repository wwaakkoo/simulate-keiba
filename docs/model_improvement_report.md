
# Phase G: モデル安定化と精度向上 (Concept Drift対策) 実践レポート

## 1. 背景：なぜモデルは劣化するのか？ (Concept Drift)

競馬予測モデルは、時間の経過とともに予測精度が低下する **Concept Drift（概念ドリフト）** という現象に直面します。

### 主な劣化要因
- **新馬の登場**: 毎年デビューする新しい馬に対応できない。
- **騎手の変化**: 若手騎手の成長やベテランの衰え、移籍。
- **環境変化**: 馬場の改修、レース傾向の変化、調教技術の進化。

これまでの実験（2024年モデルで2025年を予測）で、**的中率は高いがROIがマイナス** になる現象が見られましたが、これは学習データが古くなり、最新のオッズ傾向や穴馬パターンに対応できなくなっていたことが一因です。

---

## 2. 実施した対策

Phase Gでは、この問題に対処するために以下の3つの柱でシステムを強化しました。

### G-2: Incremental Learning (継続的再学習)
**「常に最新の記憶を保つ脳」** を実装しました。

- **仕組み**:
  - 定期的（月次など）にモデルを再学習します。
  - **Time Decay (時間減衰)**: 直近のデータ（例: 3ヶ月以内）の重要度（Weight）を高くし、古いデータの影響を徐々に下げます。
- **効果**:
  - 2025年1月のシミュレーションで、単勝1番人気の平均勝率(約32%)を大きく上回る **約40%** の的中率を記録しました。

### G-3: Drift Detection (劣化検知センサー)
**「調子の悪さを自覚する機能」** を実装しました。

- **仕組み**:
  - 日々の的中率を監視し、移動平均（30日分など）を取ります。
  - ベースライン（基準精度）から一定以上低下した場合、「要再学習」のアラートを出します。
- **メリット**:
  - 無駄な連敗を防ぎ、早期にモデル修正のアクションを取れます。

### G-4: Variance Reduction (分散削減戦略)
**「当たっても儲からない」を防ぐための賭け方** を最適化しました。

どんなに高精度なモデルでも、闇雲に賭けると控除率（テラ銭 20-25%）に負けます。そこで、統計的優位性（エッジ）がある時だけ賭ける戦略を導入しました。

#### 実装した戦略
1.  **Low Variance (堅実型)**
    - **条件**: オッズ3.0倍以下 かつ 期待値(EV) > 1.3
    - **狙い**: 的中率が高く、かつ過小評価されている「鉄板軸馬」だけを狙う。
    - **結果**: ベット数は少ないが、**勝率63.6% / ROI +70.9%** を達成。

2.  **High Volume (積極型)**
    - **条件**: EV > 1.15 の上位3頭
    - **狙い**: 少しでも期待値がプラスなら広く賭け、試行回数を稼いで「大数の法則」でプラスに収束させる。
    - **結果**: 1200回以上のベットで **ROI +12.3% (利益 +74,550円)** を達成。

---

## 3. 2025年1月の検証結果まとめ

| 戦略 | ベット数 | 的中率 | ROI (回収率) | 収支 | 評価 |
| :--- | :---: | :---: | :---: | :---: | :--- |
| **Flat Betting** (均等) | 643 | **39.8%** | -7.8% | -5,020円 | 精度は高いが、控除率に負ける |
| **Low Variance** | 11 | **63.6%** | **70.9%** | **+7,800円** | **高効率**。資金が少ない時におすすめ |
| **High Volume** | 1215 | 6.2% | **12.3%** | **+74,550円** | **最大利益**。資金があるならこの戦略 |

## 4. 今後の運用方針

このシステムは「完成」しましたが、運用が必要です。

1.  **日次スクレイピング**: 常に最新データをDBに入れる。
2.  **週次/月次再学習**: `retrain_model.py` を実行してモデルを更新。
3.  **ドリフト監視**: 精度が落ちてきたら即座に再学習。
